<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    
    <link rel="stylesheet" href="style_search.css">
    <link rel="icon" href="./source/favicon.ico" type="image/x-icon" sizes="16x16">
    
    <title>북미</title>
</head>

<body>
    <nav class="navbar navbar-light bg-light">
        <div class="container">
            <span class="navbar-brand mb-0 h1" style="font-size: 2em; font-weight: 900;"><a href="./index.html" class="text-decoration-none text-black"><i class="bi bi-book"></i> 북미</span></a>
        </div>
    </nav>

    <div id="result_container" class="container">
        <div class="d-flex align-items-center my-5">
            <input type="text" id="query" class="form-control" placeholder="책 이름 검색" autofocus>
            <button type="button" id="search" class="btn btn-primary text-nowrap ms-2">
                <i class="bi bi-search me-1"></i>검색
            </button>
        </div>
    </div>

    <div class="container">
        <div class="row g-4 py-3 row-cols-1 row-cols-lg-2" id="result">

            <!-- <div class="col p-3 border-bottom">
                <div class="d-flex">
                    <img class="result_image w-25" src="https://cdn.imweb.me/upload/S20200903356594b8dc821/691fca57291e9.jpg">
                    <div class="ms-3">
                        <p class="h2">제목</p>
                        <p>
                            저자<br>출판사<br>출판연도
                        </p>
                    </div>
                </div>
                <p class="mt-3">소개소개~</p>
            </div> -->

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <script>
        window.addEventListener("load", () => {
            // 검색 키워드 갖고 오기
            let search_keyword = localStorage.getItem("search_keyword");
            let search_bar = document.querySelector("#query");
            search_bar.value = search_keyword;

            // 사용 후 삭제
            localStorage.removeItem("search_keyword");

            var pageNum = 1;

            $("#result").html("");

            $.ajax({
                method: "GET",
                url: "https://dapi.kakao.com/v3/search/book?target=title",
                data: { query: $("#query").val(), page: pageNum },
                headers: { Authorization: "KakaoAK f198d1d8b96d8e4ce4da79f58b1c6ca4" }

            })
            .done(function (msg) {
                console.log(msg);
                for (var i = 0; i < 10; i++) {
                    let content = "<div class='col p-3 border-bottom'><div class='d-flex'><img class='result_image w-25' src='" + msg.documents[i].thumbnail + "'><div class='ms-3'><p class='h3'><a class='text-decoration-none text-black' href='" + msg.documents[i].url + "'>" + msg.documents[i].title + "</a></p><p>" + msg.documents[i].authors + "<br>" + msg.documents[i].publisher + "<br>" + msg.documents[i].datetime.slice(0, 4) + "</p></div></div><p class='mt-3'>" + msg.documents[i].contents;
                    if(msg.documents[i].contents.length >= 250) {
                        content += "...";
                    }
                    content += "</p></div>"
                    $("#result").append(content);
                }
            });
        })

        $(document).ready(function () {
            var pageNum = 1;

            $("#search").click(function () {
                $("#result").html("");

                $.ajax({
                    method: "GET",
                    url: "https://dapi.kakao.com/v3/search/book?target=title",
                    data: { query: $("#query").val(), page: pageNum },
                    headers: { Authorization: "KakaoAK f198d1d8b96d8e4ce4da79f58b1c6ca4" }

                })
                .done(function (msg) {
                    console.log(msg);
                    for (var i = 0; i < 10; i++) {
                        let content = "<div class='col p-3 border-bottom'><div class='d-flex'><img class='result_image w-25' src='" + msg.documents[i].thumbnail + "'><div class='ms-3'><p class='h3'><a class='text-decoration-none text-black' href='" + msg.documents[i].url + "'>" + msg.documents[i].title + "</a></p><p>" + msg.documents[i].authors + "<br>" + msg.documents[i].publisher + "<br>" + msg.documents[i].datetime.slice(0, 4) + "</p></div></div><p class='mt-3'>" + msg.documents[i].contents;
                        if(msg.documents[i].contents.length >= 250) {
                            content += "...";
                        }
                        content += "</p></div>"
                        $("#result").append(content);
                    }
                });
            })

            $(window).scroll(function () {

                if (Math.ceil($(window).scrollTop()) + $(window).height() >= $(document).height()) {
                    pageNum++;


                    $.ajax({
                        method: "GET",
                        url: "https://dapi.kakao.com/v3/search/book?target=title",
                        data: { query: $("#query").val(), page: pageNum },
                        headers: { Authorization: "KakaoAK f198d1d8b96d8e4ce4da79f58b1c6ca4" }

                    })
                    .done(function (msg) {
                        console.log(msg);
                        for (var i = 0; i < 10; i++) {
                            let content = "<div class='col p-3 border-bottom'><div class='d-flex'><img class='result_image w-25' src='" + msg.documents[i].thumbnail + "'><div class='ms-3'><p class='h3'>" + msg.documents[i].title + "</p><p>" + msg.documents[i].authors + "<br>" + msg.documents[i].publisher + "<br>" + msg.documents[i].datetime.slice(0, 4) + "</p></div></div><p class='mt-3'>" + msg.documents[i].contents;
                            if(msg.documents[i].contents.length >= 250) {
                                content += "...";
                            }
                            content += "</p></div>"
                            $("#result").append(content);
                        }
                    });

                }

            });
        })


    </script>
</body>

</html>